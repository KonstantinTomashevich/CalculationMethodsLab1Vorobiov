#include "gaussianintegral.h"
#include <stdio.h>

static double gaussian2[] = {0.21132486540518711774542560974902, 0.5,
                             0.78867513459481288225457439025098, 0.5};

static double gaussian3[] = {0.5 + 0.5 * -0.77459666924148337703, 0.5 * 5 / 9,
                             0.5 + 0.5 * 0, 0.5 * 8 / 9,
                             0.5 + 0.5 * 0.77459666924148337703, 0.5 * 5 / 9};

static double gaussian4[] = {0.5 + 0.5 * -0.86113631159405257522, 0.5 * 0.34785484513745385737,
                             0.5 + 0.5 * -0.33998104358485626480, 0.5 * 0.65214515486254614262,
                             0.5 + 0.5 * 0.86113631159405257522, 0.5 * 0.34785484513745385737,
                             0.5 + 0.5 * 0.33998104358485626480, 0.5 * 0.65214515486254614262};

static double gaussian5[] = {0.5 + 0.5 * 0, 0.5 * 0.568888888888888888889,
                             0.5 + 0.5 * -0.90617984593866399279, 0.5 * 0.23692688505618908751,
                             0.5 + 0.5 * -0.53846931010568309103, 0.5 * 0.47862867049936646804,
                             0.5 + 0.5 * 0.90617984593866399279, 0.5 * 0.23692688505618908751,
                             0.5 + 0.5 * 0.53846931010568309103, 0.5 * 0.47862867049936646804};

static double gaussian6[] = {0.5 + 0.5 * -0.23861918608319690863, 0.5 * 0.46791393457269104738,
                             0.5 + 0.5 * -0.66120938646626451366, 0.5 * 0.36076157304813860756,
                             0.5 + 0.5 * -0.93246951420315202781, 0.5 * 0.17132449237917034504,
                             0.5 + 0.5 * 0.23861918608319690863, 0.5 * 0.46791393457269104738,
                             0.5 + 0.5 * 0.66120938646626451366, 0.5 * 0.36076157304813860756,
                             0.5 + 0.5 * 0.93246951420315202781, 0.5 * 0.17132449237917034504};

static double gaussian7[] = {0.5 + 0.5 * 0, 0.5 * 0.41795918367346938775,
                             0.5 + 0.5 * -0.40584515137739716690, 0.5 * 0.38183005050511894495,
                             0.5 + 0.5 * -0.74153118559939443986, 0.5 * 0.27970539148927666790,
                             0.5 + 0.5 * -0.94910791234275852452, 0.5 * 0.12948496616886969327,
                             0.5 + 0.5 * 0.40584515137739716690, 0.5 * 0.38183005050511894495,
                             0.5 + 0.5 * 0.74153118559939443986, 0.5 * 0.27970539148927666790,
                             0.5 + 0.5 * 0.94910791234275852452, 0.5 * 0.12948496616886969327};

static double *gaussian[] = {gaussian2, gaussian3, gaussian4, gaussian5, gaussian6, gaussian7};

double GaussianIntegral (double (*F) (double), int power, double a, double b, long parts)
{
    if (power < 2 || power > 7)
    {
        printf ("Newton integral power must be >= 2 and <= 7!\n");
        return 0.0;
    }

    double x = a;
    double sum = 0.0;
    double step = (b - a) / parts;
    double *coefficients = gaussian[power - 2];

    while (parts--)
    {
        for (int i = 0; i < power * 2; i += 2)
        {
            sum += step * F (x + step * coefficients[i]) * coefficients[i + 1];
        }

        x += step;
    }

    return sum;
}
